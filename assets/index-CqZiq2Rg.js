import{j as e,X as p,x as b,t as S,q as y,r as w,a2 as x,a4 as f,aA as M,a3 as j,a5 as g,J as R,a6 as F,a7 as I,a8 as H,B as c}from"./index-BGfUVu-S.js";import{a as L,b as N,c as T,d as k,A as B}from"./chunk-CRBMUVJA-o8xZl27n.js";import{C as P,b as C,a as z}from"./chunk-YQO7BFFX-CUymwyLU.js";import{h as O}from"./helperText-BjkVZXYi.js";import{u as A}from"./useProfile-B0352x69.js";import{u as E}from"./useSubmitHandlers-Pj0oRakZ.js";import{u as D}from"./index.esm-QuqdPL-o.js";import{D as q}from"./chunk-7YYN6TNS-C-3WFcXs.js";import{u as U}from"./chunk-7JBTTEVG-DY5WfFj4.js";import{A as V,a as J,M as W,H as Y}from"./chunk-RAWN7VJ3-CwTq8yMi.js";import{M as _,c as $,d as X}from"./chunk-4FCEGNGT-CWNR6xLH.js";import{M as G}from"./chunk-OFOVX77R-UToEHXKx.js";import{L as K}from"./LogoutBtn-DAu4XhH7.js";import{D as Q}from"./chunk-W7WUSNWJ-DKxHapzC.js";import{S as Z}from"./chunk-7254PCTD-C1bqhFCI.js";import"./chunk-RKXMPHPI-B1ltDBpa.js";import"./chunk-OCNORRQU-pJs5jjH1.js";import"./index-BRXxiQAH.js";import"./index-jI1LxAkv.js";function h({heading:s,children:o}){return e.jsxs(L,{children:[e.jsxs(N,{children:[e.jsx(p,{flex:1,textAlign:"left",children:e.jsx(b,{size:"sm",children:s})}),e.jsx(T,{})]}),e.jsx(k,{children:e.jsx(P,{variant:{base:"unstyled",sm:"outline"},size:{base:"sm",sm:"md"},children:e.jsx(C,{children:o})})})]})}async function ee(s){return fetch("https://lorem-backend-6ggh.onrender.com/api/me/password",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}function se(){const s=D(),{toast:o,...r}=S(),n=y(),t=async()=>ee(s.getValues()),a=w.useMemo(()=>({400:async d=>{const{feedback:l}=await d.json();l.forEach(({subject:u,message:m})=>s.setError(u,{message:m}))},429:()=>r.tooMany15(),500:()=>r.serverError(),200:()=>{s.reset(),o({status:"success",title:"Password Successfully Reset"})},401:()=>{r.unauthorized(),n("/auth/login")}}),[]),i=E(t,a);return{form:s,onSubmit:i}}function v({form:s}){var o;return e.jsxs(x,{isRequired:!0,isInvalid:s.formState.errors.currentPassword,mb:6,children:[e.jsx(f,{children:"Current Password"}),e.jsx(M,{placeholder:"Enter current password",...s.register("currentPassword",{required:"Please enter your current password"})}),e.jsx(j,{children:(o=s.formState.errors.currentPassword)==null?void 0:o.message})]})}function re(){var n,t;const{form:s,onSubmit:o}=se(),{data:r}=A();return e.jsx(p,{maxW:96,children:e.jsxs("form",{onSubmit:s.handleSubmit(o),"aria-label":"Change Password Form",children:[e.jsx(v,{form:s}),e.jsxs(x,{isRequired:!0,isInvalid:s.formState.errors.newPassword,mb:6,children:[e.jsx(f,{children:"New Password"}),e.jsx(g,{placeholder:"Enter new password",type:"password",...s.register("newPassword",R)}),e.jsx(j,{children:(n=s.formState.errors.newPassword)==null?void 0:n.message}),e.jsx(F,{children:e.jsx(I,{children:O.newPwd.map((a,i)=>e.jsx(H,{children:a},i))})})]}),e.jsxs(x,{mb:6,isRequired:!0,isInvalid:s.formState.errors.confirmNewPassword,children:[e.jsx(f,{children:"Confirm New Password"}),e.jsx(g,{placeholder:"Re-enter password",type:"password",...s.register("confirmNewPassword",{required:"Please confirm your new password",validate:a=>s.getValues("newPassword")===a||"Passwords do not match"})}),e.jsx(j,{children:(t=s.formState.errors.confirmNewPassword)==null?void 0:t.message})]}),e.jsx(c,{type:"submit",w:"full",isLoading:s.formState.isSubmitting,isDisabled:(r==null?void 0:r.profile.username)==="DEMO_USER",children:"Submit"})]})})}async function oe(s){return fetch("https://lorem-backend-6ggh.onrender.com/api/me",{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}function te(){const s=D(),{toast:o,...r}=S(),n=y(),t=async()=>oe(s.getValues()),a=w.useMemo(()=>({400:async d=>{const{feedback:l}=await d.json();l.forEach(({subject:u,message:m})=>s.setError(u,{message:m}))},429:()=>r.tooMany15(),500:()=>r.serverError(),200:()=>{o({status:"success",title:"Account successfully deleted",description:"You will be redirected shortly."}),setTimeout(n,3e3,"/")},401:()=>{r.unauthorized(),n("/auth/login")}}),[]),i=E(t,a);return{form:s,onSubmit:i}}function ne(){const{form:s,onSubmit:o}=te(),{isOpen:r,onOpen:n,onClose:t}=U(),a=w.useRef(),{data:i}=A();return e.jsxs(p,{maxW:96,children:[e.jsx("form",{children:e.jsx(v,{form:s})}),e.jsx(c,{w:"full",onClick:s.handleSubmit(n),isLoading:s.formState.isSubmitting,isDisabled:(i==null?void 0:i.profile.username)==="DEMO_USER",children:"Submit"}),e.jsxs(V,{isOpen:r,onClose:t,size:"sm",children:[e.jsx(_,{}),e.jsxs(J,{mx:4,children:[e.jsx($,{children:"Delete Account?"}),e.jsx(X,{}),e.jsx(G,{children:"Are you sure you want to delete your account? This action cannot be undone."}),e.jsx(W,{children:e.jsxs(Y,{gap:3,children:[e.jsx(c,{ref:a,onClick:t,children:"Cancel"}),e.jsx(c,{colorScheme:"red",onClick:()=>{t(),o()},rightIcon:e.jsx(q,{}),children:"Confirm"})]})})]})]})]})}function ae(){return e.jsxs(P,{variant:{base:"unstyled",md:"outline"},flex:1,size:"sm",minH:{md:"calc(100vh - 88px)"},maxW:"full",children:[e.jsx(z,{children:e.jsx(b,{size:"md",children:"User Settings"})}),e.jsx(Q,{my:{base:4,md:0}}),e.jsx(C,{children:e.jsx(Z,{in:!0,offsetY:10,children:e.jsxs(B,{allowToggle:!0,children:[e.jsx(h,{heading:"Change Password",children:e.jsx(re,{})}),e.jsx(h,{heading:"Delete Account",children:e.jsx(ne,{})}),e.jsx(h,{heading:"Logout",children:e.jsx(K,{variant:"text"})})]})})})]})}function Ee(){return e.jsx(ae,{})}export{Ee as default};
