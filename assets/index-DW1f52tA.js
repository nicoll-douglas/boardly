import{j as e,X as p,b,c as y,u as S,r as w,a2 as x,a4 as f,aB as M,a3 as j,a5 as g,p as D,a6 as F,a7 as I,a8 as R,B as i}from"./index-CGogLOa5.js";import{a as B,b as H,c as L,d as N,A as T}from"./chunk-CRBMUVJA-C6Z9ZjxT.js";import{C as P,b as C,a as k}from"./chunk-YQO7BFFX-5BnUq4eQ.js";import{h as z}from"./helperText-BjkVZXYi.js";import{u as A}from"./useSubmitHandlers-BY9hu10z.js";import{u as v}from"./index.esm-WR5xvitm.js";import{D as q}from"./chunk-7YYN6TNS-HCiS5UWi.js";import{u as O}from"./chunk-7JBTTEVG-DR3RSwZ8.js";import{A as V,a as U,M as W,H as J}from"./chunk-RAWN7VJ3-fhW4QZ-r.js";import{M as Y,c as $,d as X}from"./chunk-4FCEGNGT-Bcx3FRSi.js";import{M as G}from"./chunk-OFOVX77R-DB3nebIN.js";import{L as K}from"./LogoutBtn-Bocx47bK.js";import{D as Q}from"./chunk-W7WUSNWJ-BPC8i10o.js";import{S as Z}from"./chunk-7254PCTD-CChXirhI.js";import"./chunk-RKXMPHPI-qz9fv3BJ.js";import"./chunk-OCNORRQU-CXgUAj_E.js";import"./index-BDNKkl-y.js";import"./index-BrIZXKxt.js";function h({heading:s,children:r}){return e.jsxs(B,{children:[e.jsxs(H,{children:[e.jsx(p,{flex:1,textAlign:"left",children:e.jsx(b,{size:"sm",children:s})}),e.jsx(L,{})]}),e.jsx(N,{children:e.jsx(P,{variant:{base:"unstyled",sm:"outline"},size:{base:"sm",sm:"md"},children:e.jsx(C,{children:r})})})]})}async function _(s){return fetch("https://lorem-backend-6ggh.onrender.com/api/me/password",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}function ee(){const s=v(),{toast:r,...o}=y(),n=S(),t=async()=>_(s.getValues()),a=w.useMemo(()=>({400:async d=>{const{feedback:l}=await d.json();l.forEach(({subject:u,message:m})=>s.setError(u,{message:m}))},429:()=>o.tooMany15(),500:()=>o.serverError(),200:()=>{s.reset(),r({status:"success",title:"Password Successfully Reset"})},401:()=>{o.unauthorized(),n("/auth/login")}}),[]),c=A(t,a);return{form:s,onSubmit:c}}function E({form:s}){var r;return e.jsxs(x,{isRequired:!0,isInvalid:s.formState.errors.currentPassword,mb:6,children:[e.jsx(f,{children:"Current Password"}),e.jsx(M,{placeholder:"Enter current password",...s.register("currentPassword",{required:"Please enter your current password"})}),e.jsx(j,{children:(r=s.formState.errors.currentPassword)==null?void 0:r.message})]})}function se(){var o,n;const{form:s,onSubmit:r}=ee();return e.jsx(p,{maxW:96,children:e.jsxs("form",{onSubmit:s.handleSubmit(r),"aria-label":"Change Password Form",children:[e.jsx(E,{form:s}),e.jsxs(x,{isRequired:!0,isInvalid:s.formState.errors.newPassword,mb:6,children:[e.jsx(f,{children:"New Password"}),e.jsx(g,{placeholder:"Enter new password",type:"password",...s.register("newPassword",D)}),e.jsx(j,{children:(o=s.formState.errors.newPassword)==null?void 0:o.message}),e.jsx(F,{children:e.jsx(I,{children:z.newPwd.map((t,a)=>e.jsx(R,{children:t},a))})})]}),e.jsxs(x,{mb:6,isRequired:!0,isInvalid:s.formState.errors.confirmNewPassword,children:[e.jsx(f,{children:"Confirm New Password"}),e.jsx(g,{placeholder:"Re-enter password",type:"password",...s.register("confirmNewPassword",{required:"Please confirm your new password",validate:t=>s.getValues("newPassword")===t||"Passwords do not match"})}),e.jsx(j,{children:(n=s.formState.errors.confirmNewPassword)==null?void 0:n.message})]}),e.jsx(i,{type:"submit",w:"full",isLoading:s.formState.isSubmitting,children:"Submit"})]})})}async function re(s){return fetch("https://lorem-backend-6ggh.onrender.com/api/me",{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}function oe(){const s=v(),{toast:r,...o}=y(),n=S(),t=async()=>re(s.getValues()),a=w.useMemo(()=>({400:async d=>{const{feedback:l}=await d.json();l.forEach(({subject:u,message:m})=>s.setError(u,{message:m}))},429:()=>o.tooMany15(),500:()=>o.serverError(),200:()=>{r({status:"success",title:"Account successfully deleted",description:"You will be redirected shortly."}),setTimeout(n,3e3,"/")},401:()=>{o.unauthorized(),n("/auth/login")}}),[]),c=A(t,a);return{form:s,onSubmit:c}}function te(){const{form:s,onSubmit:r}=oe(),{isOpen:o,onOpen:n,onClose:t}=O(),a=w.useRef();return e.jsxs(p,{maxW:96,children:[e.jsx("form",{children:e.jsx(E,{form:s})}),e.jsx(i,{w:"full",onClick:s.handleSubmit(n),isLoading:s.formState.isSubmitting,children:"Submit"}),e.jsxs(V,{isOpen:o,onClose:t,size:"sm",children:[e.jsx(Y,{}),e.jsxs(U,{mx:4,children:[e.jsx($,{children:"Delete Account?"}),e.jsx(X,{}),e.jsx(G,{children:"Are you sure you want to delete your account? This action cannot be undone."}),e.jsx(W,{children:e.jsxs(J,{gap:3,children:[e.jsx(i,{ref:a,onClick:t,children:"Cancel"}),e.jsx(i,{colorScheme:"red",onClick:()=>{t(),r()},rightIcon:e.jsx(q,{}),children:"Confirm"})]})})]})]})]})}function ne(){return e.jsxs(P,{variant:{base:"unstyled",md:"outline"},flex:1,size:"sm",minH:{md:"calc(100vh - 88px)"},maxW:"full",children:[e.jsx(k,{children:e.jsx(b,{size:"md",children:"User Settings"})}),e.jsx(Q,{my:{base:4,md:0}}),e.jsx(C,{children:e.jsx(Z,{in:!0,offsetY:10,children:e.jsxs(T,{allowToggle:!0,children:[e.jsx(h,{heading:"Change Password",children:e.jsx(se,{})}),e.jsx(h,{heading:"Delete Account",children:e.jsx(te,{})}),e.jsx(h,{heading:"Logout",children:e.jsx(K,{variant:"text"})})]})})})]})}function Ce(){return e.jsx(ne,{})}export{Ce as default};
