import{i as L,u as Y,r as u,c as xe,h as H,k as oe,j as n,O as Je,a as Ze,m as z,at as re,b as y,e as et,o as tt,g as Ct,ah as nt,au as St,p as at,av as Et,F as J,I as fe,T as jt,aw as we,U as le,a2 as ge,a4 as st,a3 as ye,a5 as Nt,R as rt,s as ot,X as Pt,x as It,N as kt,ax as wt,an as _t,ao as At}from"./index-BGfUVu-S.js";import{u as Ce}from"./useProfile-B0352x69.js";import{T as Dt,u as _e,f as Rt}from"./useProtectedSubmission-CNvaje-C.js";import{F as Ft,u as Ae}from"./useSubmitHandlers-Pj0oRakZ.js";import{S as De}from"./chunk-BL2ZZSHG-qHpNGzko.js";import{u as Tt}from"./index-2Bf1Ak4H.js";import{u as Bt}from"./index-BRXxiQAH.js";import{u as Mt}from"./index-FfA0kwyu.js";import{D as Ot}from"./chunk-7YYN6TNS-C-3WFcXs.js";import{u as lt}from"./index.esm-QuqdPL-o.js";import{A as We}from"./chunk-V7PAE35Z-C3vj6xRY.js";import{S as Vt,a as he}from"./StackData-DuYmOgjm.js";import{S as Lt}from"./chunk-7254PCTD-C1bqhFCI.js";import{a as Ut,b as Kt,C as zt}from"./chunk-YQO7BFFX-CUymwyLU.js";import{D as Ht}from"./chunk-W7WUSNWJ-DKxHapzC.js";import{S as qt}from"./Spinner-ChtAEK3J.js";var it={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},Gt=L("span",{baseStyle:it});Gt.displayName="VisuallyHidden";var ut=L("input",{baseStyle:it});ut.displayName="VisuallyHiddenInput";function Wt(e){const t=parseFloat(e);return typeof t!="number"||Number.isNaN(t)?0:t}function ct(e,t){let a=Wt(e);const s=10**(t??10);return a=Math.round(a*s)/s,t?a.toFixed(t):a.toString()}function $e(e){if(!Number.isFinite(e))return 0;let t=1,a=0;for(;Math.round(e*t)/t!==e;)t*=10,a+=1;return a}function $t(e,t,a){return e==null?e:(a<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(e,t),a))}function Qt(e={}){const{onChange:t,precision:a,defaultValue:s,value:i,step:o=1,min:r=Number.MIN_SAFE_INTEGER,max:f=Number.MAX_SAFE_INTEGER,keepWithinRange:m=!0}=e,h=Y(t),[P,N]=u.useState(()=>{var x;return s==null?"":(x=ke(s,o,a))!=null?x:""}),g=typeof i<"u",S=g?i:P,U=dt(X(S),o),M=a??U,_=u.useCallback(x=>{x!==S&&(g||N(x.toString()),h==null||h(x.toString(),X(x)))},[h,g,S]),O=u.useCallback(x=>{let p=x;return m&&(p=$t(p,r,f)),ct(p,M)},[M,m,f,r]),C=u.useCallback((x=o)=>{let p;S===""?p=X(x):p=X(S)+x,p=O(p),_(p)},[O,o,_,S]),q=u.useCallback((x=o)=>{let p;S===""?p=X(-x):p=X(S)-x,p=O(p),_(p)},[O,o,_,S]),j=u.useCallback(()=>{var x;let p;s==null?p="":p=(x=ke(s,o,a))!=null?x:r,_(p)},[s,a,o,_,r]),G=u.useCallback(x=>{var p;const Z=(p=ke(x,o,M))!=null?p:r;_(Z)},[M,o,_,r]),A=X(S);return{isOutOfRange:A>f||A<r,isAtMax:A===f,isAtMin:A===r,precision:M,value:S,valueAsNumber:A,update:_,reset:j,increment:C,decrement:q,clamp:O,cast:G,setValue:N}}function X(e){return parseFloat(e.toString().replace(/[^\w.-]+/g,""))}function dt(e,t){return Math.max($e(t),$e(e))}function ke(e,t,a){const s=X(e);if(Number.isNaN(s))return;const i=dt(s,t);return ct(s,a??i)}var[Xt,Re]=xe({name:"EditableStylesContext",errorMessage:`useEditableStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Editable />" `}),[Yt,Se]=xe({name:"EditableContext",errorMessage:"useEditableContext: context is undefined. Seems you forgot to wrap the editable components in `<Editable />`"}),Fe={fontSize:"inherit",fontWeight:"inherit",textAlign:"inherit",bg:"transparent"},Te=H(function(t,a){const{getInputProps:s}=Se(),i=Re(),o=s(t,a),r=oe("chakra-editable__input",t.className);return n.jsx(L.input,{...o,__css:{outline:0,...Fe,...i.input},className:r})});Te.displayName="EditableInput";var Ee=H(function(t,a){const{getPreviewProps:s}=Se(),i=Re(),o=s(t,a),r=oe("chakra-editable__preview",t.className);return n.jsx(L.span,{...o,__css:{cursor:"text",display:"inline-block",...Fe,...i.preview},className:r})});Ee.displayName="EditablePreview";var mt=H(function(t,a){const{getTextareaProps:s}=Se(),i=Re(),o=s(t,a),r=oe("chakra-editable__textarea",t.className);return n.jsx(L.textarea,{...o,__css:{outline:0,...Fe,...i.textarea},className:r})});mt.displayName="EditableTextarea";function Qe(e,t){return e?e===t||e.contains(t):!1}function Jt(e={}){const{onChange:t,onCancel:a,onSubmit:s,onBlur:i,value:o,isDisabled:r,defaultValue:f,startWithEditView:m,isPreviewFocusable:h=!0,submitOnBlur:P=!0,selectAllOnFocus:N=!0,placeholder:g,onEdit:S,finalFocusRef:U,...M}=e,_=Y(S),O=!!(m&&!r),[C,q]=u.useState(O),[j,G]=Bt({defaultValue:f||"",value:o,onChange:t}),[A,ie]=u.useState(j),T=u.useRef(null),ue=u.useRef(null),x=u.useRef(null),p=u.useRef(null),Z=u.useRef(null);Tt({ref:T,enabled:C,elements:[p,Z]});const W=!C&&!r;Je(()=>{var c,v;C&&((c=T.current)==null||c.focus(),N&&((v=T.current)==null||v.select()))},[]),Ze(()=>{var c,v,w,I;if(!C){U?(c=U.current)==null||c.focus():(v=x.current)==null||v.focus();return}(w=T.current)==null||w.focus(),N&&((I=T.current)==null||I.select()),_==null||_()},[C,_,N]);const $=u.useCallback(()=>{W&&q(!0)},[W]),F=u.useCallback(()=>{ie(j)},[j]),D=u.useCallback(()=>{q(!1),G(A),a==null||a(A),i==null||i(A)},[a,i,G,A]),B=u.useCallback(()=>{q(!1),ie(j),s==null||s(j),i==null||i(A)},[j,s,i,A]);u.useEffect(()=>{if(C)return;const c=T.current;(c==null?void 0:c.ownerDocument.activeElement)===c&&(c==null||c.blur())},[C]);const d=u.useCallback(c=>{G(c.currentTarget.value)},[G]),Q=u.useCallback(c=>{const v=c.key,I={Escape:D,Enter:K=>{!K.shiftKey&&!K.metaKey&&B()}}[v];I&&(c.preventDefault(),I(c))},[D,B]),ce=u.useCallback(c=>{const v=c.key,I={Escape:D}[v];I&&(c.preventDefault(),I(c))},[D]),te=j.length===0,ne=u.useCallback(c=>{var v;if(!C)return;const w=c.currentTarget.ownerDocument,I=(v=c.relatedTarget)!=null?v:w.activeElement,K=Qe(p.current,I),k=Qe(Z.current,I);!K&&!k&&(P?B():D())},[P,B,D,C]),de=u.useCallback((c={},v=null)=>{const w=W&&h?0:void 0;return{...c,ref:z(v,ue),children:te?g:j,hidden:C,"aria-disabled":re(r),tabIndex:w,onFocus:y(c.onFocus,$,F)}},[r,C,W,h,te,$,F,g,j]),ae=u.useCallback((c={},v=null)=>({...c,hidden:!C,placeholder:g,ref:z(v,T),disabled:r,"aria-disabled":re(r),value:j,onBlur:y(c.onBlur,ne),onChange:y(c.onChange,d),onKeyDown:y(c.onKeyDown,Q),onFocus:y(c.onFocus,F)}),[r,C,ne,d,Q,F,g,j]),V=u.useCallback((c={},v=null)=>({...c,hidden:!C,placeholder:g,ref:z(v,T),disabled:r,"aria-disabled":re(r),value:j,onBlur:y(c.onBlur,ne),onChange:y(c.onChange,d),onKeyDown:y(c.onKeyDown,ce),onFocus:y(c.onFocus,F)}),[r,C,ne,d,ce,F,g,j]),se=u.useCallback((c={},v=null)=>({"aria-label":"Edit",...c,type:"button",onClick:y(c.onClick,$),ref:z(v,x),disabled:r}),[$,r]),be=u.useCallback((c={},v=null)=>({...c,"aria-label":"Submit",ref:z(Z,v),type:"button",onClick:y(c.onClick,B),disabled:r}),[B,r]),pe=u.useCallback((c={},v=null)=>({"aria-label":"Cancel",id:"cancel",...c,ref:z(p,v),type:"button",onClick:y(c.onClick,D),disabled:r}),[D,r]);return{isEditing:C,isDisabled:r,isValueEmpty:te,value:j,onEdit:$,onCancel:D,onSubmit:B,getPreviewProps:de,getInputProps:ae,getTextareaProps:V,getEditButtonProps:se,getSubmitButtonProps:be,getCancelButtonProps:pe,htmlProps:M}}var je=H(function(t,a){const s=et("Editable",t),i=tt(t),{htmlProps:o,...r}=Jt(i),{isEditing:f,onSubmit:m,onCancel:h,onEdit:P}=r,N=oe("chakra-editable",t.className),g=Ct(t.children,{isEditing:f,onSubmit:m,onCancel:h,onEdit:P});return n.jsx(Yt,{value:r,children:n.jsx(Xt,{value:s,children:n.jsx(L.div,{ref:a,...o,className:N,children:g})})})});je.displayName="Editable";function Zt(){const{isEditing:e,getEditButtonProps:t,getCancelButtonProps:a,getSubmitButtonProps:s}=Se();return{isEditing:e,getEditButtonProps:t,getCancelButtonProps:a,getSubmitButtonProps:s}}var en=e=>n.jsx(nt,{viewBox:"0 0 24 24",...e,children:n.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),tn=e=>n.jsx(nt,{viewBox:"0 0 24 24",...e,children:n.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function Xe(e,t,a,s){u.useEffect(()=>{var i;if(!e.current||!s)return;const o=(i=e.current.ownerDocument.defaultView)!=null?i:window,r=Array.isArray(t)?t:[t],f=new o.MutationObserver(m=>{for(const h of m)h.type==="attributes"&&h.attributeName&&r.includes(h.attributeName)&&a(h)});return f.observe(e.current,{attributes:!0,attributeFilter:r}),()=>f.disconnect()})}function nn(e,t){const a=Y(e);u.useEffect(()=>{let s=null;const i=()=>a();return t!==null&&(s=window.setInterval(i,t)),()=>{s&&window.clearInterval(s)}},[t,a])}var an=50,Ye=300;function sn(e,t){const[a,s]=u.useState(!1),[i,o]=u.useState(null),[r,f]=u.useState(!0),m=u.useRef(null),h=()=>clearTimeout(m.current);nn(()=>{i==="increment"&&e(),i==="decrement"&&t()},a?an:null);const P=u.useCallback(()=>{r&&e(),m.current=setTimeout(()=>{f(!1),s(!0),o("increment")},Ye)},[e,r]),N=u.useCallback(()=>{r&&t(),m.current=setTimeout(()=>{f(!1),s(!0),o("decrement")},Ye)},[t,r]),g=u.useCallback(()=>{f(!0),s(!1),h()},[]);return u.useEffect(()=>()=>h(),[]),{up:P,down:N,stop:g,isSpinning:a}}var rn=/^[Ee0-9+\-.]$/;function on(e){return rn.test(e)}function ln(e,t){if(e.key==null)return!0;const a=e.ctrlKey||e.altKey||e.metaKey;return!(e.key.length===1)||a?!0:t(e.key)}function un(e={}){const{focusInputOnChange:t=!0,clampValueOnBlur:a=!0,keepWithinRange:s=!0,min:i=Number.MIN_SAFE_INTEGER,max:o=Number.MAX_SAFE_INTEGER,step:r=1,isReadOnly:f,isDisabled:m,isRequired:h,isInvalid:P,pattern:N="[0-9]*(.[0-9]+)?",inputMode:g="decimal",allowMouseWheel:S,id:U,onChange:M,precision:_,name:O,"aria-describedby":C,"aria-label":q,"aria-labelledby":j,onFocus:G,onBlur:A,onInvalid:ie,getAriaValueText:T,isValidCharacter:ue,format:x,parse:p,...Z}=e,W=Y(G),$=Y(A),F=Y(ie),D=Y(ue??on),B=Y(T),d=Qt(e),{update:Q,increment:ce,decrement:te}=d,[ne,de]=u.useState(!1),ae=!(f||m),V=u.useRef(null),se=u.useRef(null),be=u.useRef(null),pe=u.useRef(null),c=u.useCallback(l=>l.split("").filter(D).join(""),[D]),v=u.useCallback(l=>{var b;return(b=p==null?void 0:p(l))!=null?b:l},[p]),w=u.useCallback(l=>{var b;return((b=x==null?void 0:x(l))!=null?b:l).toString()},[x]);Ze(()=>{(d.valueAsNumber>o||d.valueAsNumber<i)&&(F==null||F("rangeOverflow",w(d.value),d.valueAsNumber))},[d.valueAsNumber,d.value,w,F]),Je(()=>{if(!V.current)return;if(V.current.value!=d.value){const b=v(V.current.value);d.setValue(c(b))}},[v,c]);const I=u.useCallback((l=r)=>{ae&&ce(l)},[ce,ae,r]),K=u.useCallback((l=r)=>{ae&&te(l)},[te,ae,r]),k=sn(I,K);Xe(be,"disabled",k.stop,k.isSpinning),Xe(pe,"disabled",k.stop,k.isSpinning);const Ie=u.useCallback(l=>{if(l.nativeEvent.isComposing)return;const E=v(l.currentTarget.value);Q(c(E)),se.current={start:l.currentTarget.selectionStart,end:l.currentTarget.selectionEnd}},[Q,c,v]),Oe=u.useCallback(l=>{var b,E,R;W==null||W(l),se.current&&(l.target.selectionStart=(E=se.current.start)!=null?E:(b=l.currentTarget.value)==null?void 0:b.length,l.currentTarget.selectionEnd=(R=se.current.end)!=null?R:l.currentTarget.selectionStart)},[W]),Ve=u.useCallback(l=>{if(l.nativeEvent.isComposing)return;ln(l,D)||l.preventDefault();const b=Le(l)*r,E=l.key,ee={ArrowUp:()=>I(b),ArrowDown:()=>K(b),Home:()=>Q(i),End:()=>Q(o)}[E];ee&&(l.preventDefault(),ee(l))},[D,r,I,K,Q,i,o]),Le=l=>{let b=1;return(l.metaKey||l.ctrlKey)&&(b=.1),l.shiftKey&&(b=10),b},Ue=u.useMemo(()=>{const l=B==null?void 0:B(d.value);if(l!=null)return l;const b=d.value.toString();return b||void 0},[d.value,B]),Ke=u.useCallback(()=>{let l=d.value;if(d.value==="")return;/^[eE]/.test(d.value.toString())?d.setValue(""):(d.valueAsNumber<i&&(l=i),d.valueAsNumber>o&&(l=o),d.cast(l))},[d,o,i]),ze=u.useCallback(()=>{de(!1),a&&Ke()},[a,de,Ke]),ve=u.useCallback(()=>{t&&requestAnimationFrame(()=>{var l;(l=V.current)==null||l.focus()})},[t]),He=u.useCallback(l=>{l.preventDefault(),k.up(),ve()},[ve,k]),qe=u.useCallback(l=>{l.preventDefault(),k.down(),ve()},[ve,k]);Mt(()=>V.current,"wheel",l=>{var b,E;const ee=((E=(b=V.current)==null?void 0:b.ownerDocument)!=null?E:document).activeElement===V.current;if(!S||!ee)return;l.preventDefault();const me=Le(l)*r,Ge=Math.sign(l.deltaY);Ge===-1?I(me):Ge===1&&K(me)},{passive:!1});const xt=u.useCallback((l={},b=null)=>{const E=m||s&&d.isAtMax;return{...l,ref:z(b,be),role:"button",tabIndex:-1,onPointerDown:y(l.onPointerDown,R=>{R.button!==0||E||He(R)}),onPointerLeave:y(l.onPointerLeave,k.stop),onPointerUp:y(l.onPointerUp,k.stop),disabled:E,"aria-disabled":re(E)}},[d.isAtMax,s,He,k.stop,m]),gt=u.useCallback((l={},b=null)=>{const E=m||s&&d.isAtMin;return{...l,ref:z(b,pe),role:"button",tabIndex:-1,onPointerDown:y(l.onPointerDown,R=>{R.button!==0||E||qe(R)}),onPointerLeave:y(l.onPointerLeave,k.stop),onPointerUp:y(l.onPointerUp,k.stop),disabled:E,"aria-disabled":re(E)}},[d.isAtMin,s,qe,k.stop,m]),yt=u.useCallback((l={},b=null)=>{var E,R,ee,me;return{name:O,inputMode:g,type:"text",pattern:N,"aria-labelledby":j,"aria-label":q,"aria-describedby":C,id:U,disabled:m,...l,readOnly:(E=l.readOnly)!=null?E:f,"aria-readonly":(R=l.readOnly)!=null?R:f,"aria-required":(ee=l.required)!=null?ee:h,required:(me=l.required)!=null?me:h,ref:z(V,b),value:w(d.value),role:"spinbutton","aria-valuemin":i,"aria-valuemax":o,"aria-valuenow":Number.isNaN(d.valueAsNumber)?void 0:d.valueAsNumber,"aria-invalid":re(P??d.isOutOfRange),"aria-valuetext":Ue,autoComplete:"off",autoCorrect:"off",onChange:y(l.onChange,Ie),onKeyDown:y(l.onKeyDown,Ve),onFocus:y(l.onFocus,Oe,()=>de(!0)),onBlur:y(l.onBlur,$,ze)}},[O,g,N,j,q,w,C,U,m,h,f,P,d.value,d.valueAsNumber,d.isOutOfRange,i,o,Ue,Ie,Ve,Oe,$,ze]);return{value:w(d.value),valueAsNumber:d.valueAsNumber,isFocused:ne,isDisabled:m,isReadOnly:f,getIncrementButtonProps:xt,getDecrementButtonProps:gt,getInputProps:yt,htmlProps:Z}}var[cn,Ne]=xe({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[dn,Be]=xe({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),ft=H(function(t,a){const s=et("NumberInput",t),i=tt(t),o=St(i),{htmlProps:r,...f}=un(o),m=u.useMemo(()=>f,[f]);return n.jsx(dn,{value:m,children:n.jsx(cn,{value:s,children:n.jsx(L.div,{...r,ref:a,className:oe("chakra-numberinput",t.className),__css:{position:"relative",zIndex:0,...s.root}})})})});ft.displayName="NumberInput";var mn=H(function(t,a){const s=Ne();return n.jsx(L.div,{"aria-hidden":!0,ref:a,...t,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...s.stepperGroup}})});mn.displayName="NumberInputStepper";var bt=H(function(t,a){const{getInputProps:s}=Be(),i=s(t,a),o=Ne();return n.jsx(L.input,{...i,className:oe("chakra-numberinput__field",t.className),__css:{width:"100%",...o.field}})});bt.displayName="NumberInputField";var pt=L("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),fn=H(function(t,a){var s;const i=Ne(),{getDecrementButtonProps:o}=Be(),r=o(t,a);return n.jsx(pt,{...r,__css:i.stepper,children:(s=t.children)!=null?s:n.jsx(en,{})})});fn.displayName="NumberDecrementStepper";var bn=H(function(t,a){var s;const{getIncrementButtonProps:i}=Be(),o=i(t,a),r=Ne();return n.jsx(pt,{...o,__css:r.stepper,children:(s=t.children)!=null?s:n.jsx(tn,{})})});bn.displayName="NumberIncrementStepper";const pn=e=>/^\d+$/.test(e);var vt=at({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),ht=at({viewBox:"0 0 14 14",path:n.jsx("g",{fill:"currentColor",children:n.jsx("polygon",{points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"})})});function Me({withLength:e,maxLength:t,submitId:a,cancelId:s,...i}){const{isEditing:o,getSubmitButtonProps:r,getCancelButtonProps:f}=Zt(),m=Et("red.500","red.300");if(o)return n.jsx(Ft,{in:o,children:n.jsxs(J,{gap:1,...i,children:[n.jsx(fe,{variant:"ghost",size:"xs",icon:n.jsx(ht,{}),colorScheme:"green","data-cy":a,"aria-label":"Confirm",...r()}),n.jsx(fe,{variant:"ghost",size:"xs",colorScheme:"red","data-cy":s,icon:n.jsx(vt,{boxSize:"10px"}),"aria-label":"Cancel",...f()}),n.jsx(De,{}),Number.isInteger(e)&&n.jsx(J,{fontSize:"13px",children:n.jsx(jt,{color:e>t&&m,children:t-e})})]})})}const Pe={age:{required:!1,setValueAs:e=>e==="0"?0:e===""?"":Number(e),min:{value:0,message:"Age must be greater than 0"},max:{value:120,message:"Age must be no more than 120"}},pronouns:{required:!1,maxLength:{value:10,message:"Pronouns must be no longer than 10 characters"}},bio:{required:!1,maxLength:{value:100,message:"Bio must be no longer than 100 characters"}},avatar:{required:!1,validate:{size:([e])=>e.size<=we.imgUploads.maxSize||"Avatar size must be no more than 2MB",dimensions:async([e])=>new Promise(t=>{const a=new Image,s=URL.createObjectURL(e);a.src=s;const{maxDimensions:i}=we.imgUploads;a.onload=()=>{URL.revokeObjectURL(s);const o=a.width<i.width&&a.height<i.height;t(o||`Avatar dimensions must be no more than ${i.width}x${i.height}`)},a.onerror=()=>{URL.revokeObjectURL(s),t("Avatar file could not be loaded")}})}}};function vn({editor:e}){const{form:t,onSubmit:a,onCancel:s,values:i}=e,o=t.formState.errors.age,[r]=le();return n.jsxs(ge,{isInvalid:o,children:[n.jsxs(je,{value:i.age,onSubmit:a,onCancel:s,h:14,isDisabled:!r,placeholder:"-",children:[n.jsxs(J,{children:[n.jsx(st,{mb:0,children:"Age"}),n.jsx(De,{}),n.jsx(Me,{})]}),n.jsx(Ee,{minW:"full",h:8}),n.jsx(ft,{variant:"flushed",isValidCharacter:pn,children:n.jsx(bt,{as:Te,height:8,"data-cy":"Profile-editable-input",...t.register("age",Pe.age)})})]}),n.jsx(ye,{mt:1,children:o==null?void 0:o.message})]})}function hn({editor:e}){const{form:t,onSubmit:a,onCancel:s,values:i}=e,o=t.formState.errors.pronouns,[r]=le();return n.jsxs(ge,{isInvalid:o,children:[n.jsxs(je,{h:14,value:i.pronouns,onSubmit:a,onCancel:s,isDisabled:!r,placeholder:"-",children:[n.jsxs(J,{children:[n.jsx(st,{mb:0,children:"Pronouns"}),n.jsx(De,{}),n.jsx(Me,{})]}),n.jsx(Ee,{h:8,minW:"full"}),n.jsx(Nt,{as:Te,height:8,variant:"flushed","data-cy":"Profile-editable-input",...t.register("pronouns",Pe.pronouns)})]}),n.jsx(ye,{mt:1,children:o==null?void 0:o.message})]})}function xn({editor:e}){const{form:t,onSubmit:a,onCancel:s,values:i}=e,o=t.formState.errors.bio,[r]=le();return n.jsxs(ge,{isInvalid:o,children:[n.jsxs(je,{value:i.bio,onSubmit:a,onCancel:s,isDisabled:!r,placeholder:"-",children:[n.jsx(Ee,{"data-cy":"Profile-bio-editable-preview",minH:8,lineHeight:"22px",w:"full"}),n.jsx(Dt,{as:mt,variant:"flushed",py:1,resize:"none",rows:3,id:"bio-editable-input","data-cy":"Profile-editable-input",spellCheck:!1,...t.register("bio",Pe.bio)}),n.jsx(Me,{mt:1,withLength:i.bio.length,maxLength:100,submitId:"Profile-bio-submit",cancelId:"Profile-bio-cancel"})]}),n.jsx(ye,{mt:1,children:o==null?void 0:o.message})]})}async function gn(e){const t=new FormData;return t.append("avatar",e,crypto.randomUUID()),fetch("https://lorem-backend-6ggh.onrender.com/api/me/avatar",{method:"PUT",credentials:"include",body:t})}function yn(){return fetch("https://lorem-backend-6ggh.onrender.com/api/me/avatar",{method:"DELETE",credentials:"include"})}function Cn(){const{data:e}=Ce(),[t,a]=u.useState(e.profile.avatar),[s,i]=u.useState(!0),o=rt(),r=lt(),f=u.useRef(null),m=r.watch("avatar"),h=()=>{r.reset(),a(e.profile.avatar),i(!0),f.current&&(f.current.value="")},P=()=>f.current.click(),N=ot(),g=_e(()=>{o.invalidateQueries({queryKey:["GET /api/me"]}),i(!0),a(e.profile.avatar),N({status:"success",title:"Successfully updated avatar"})}),S=_e(()=>{o.invalidateQueries({queryKey:["GET /api/me"]}),i(!0),a(e.profile.avatar),N({status:"success",title:"Successfully removed avatar"})}),U=Ae(yn,S),M=Ae(async()=>gn(m==null?void 0:m[0]),g);return u.useEffect(()=>(URL.revokeObjectURL(t),m!=null&&m[0]?(a(URL.createObjectURL(m[0])),i(!1)):h(),()=>URL.revokeObjectURL(t)),[m]),{avatarSrc:t,editHidden:s,inputRef:f,form:r,handleReset:h,handleEdit:P,onEdit:r.handleSubmit(M),onDelete:U}}function Sn(){const{data:e}=Ce(),{form:t,inputRef:a,avatarSrc:s,editHidden:i,handleReset:o,handleEdit:r,onEdit:f,onDelete:m}=Cn(),[h]=le(),{ref:P,...N}=t.register("avatar",Pe.avatar),g=t.formState.errors.avatar;return h?n.jsxs(ge,{isInvalid:g,display:"flex",gap:4,children:[n.jsx(We,{size:"lg",src:s,name:e.profile.username,onClick:r,cursor:"pointer",children:n.jsx(ut,{type:"file",multiple:!1,accept:we.imgUploads.allowedTypes.join(),"data-cy":"Profile-editable-input",ref:S=>{P(S),a.current=S},...N})}),n.jsxs(J,{flexDir:"column",gap:1,my:"auto",children:[i?e.profile.hasAvatar&&n.jsx(fe,{size:"xs",variant:"ghost",colorScheme:"red",icon:n.jsx(Ot,{}),onClick:m,"aria-label":"Remove avatar"}):n.jsxs(J,{gap:1,children:[n.jsx(fe,{variant:"ghost",size:"xs",icon:n.jsx(ht,{}),colorScheme:"green",onClick:f,"aria-label":"Confirm"}),n.jsx(fe,{variant:"ghost",size:"xs",colorScheme:"red",icon:n.jsx(vt,{boxSize:"10px"}),onClick:o,"aria-label":"Cancel"})]}),n.jsx(ye,{mt:0,children:g==null?void 0:g.message})]})]}):n.jsx(We,{size:"lg",src:e.profile.avatar,name:e.profile.username})}async function En(e){return fetch("https://lorem-backend-6ggh.onrender.com/api/me",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}function jn(e,t){let a=!1;const s=Object.entries(e);for(let i=0;i<s.length;i++){const[o,r]=s[i];if(t[o]!==r){a=!0;break}}return a}function Nn(e){const t={bio:e.bio||"",pronouns:e.pronouns||"",age:e.age??""},a=lt({defaultValues:t}),s=rt(),i=ot(),o=a.watch();u.useEffect(()=>{a.reset(t)},[e]);const r=_e(()=>{s.invalidateQueries({queryKey:["GET /api/me"]}),i({status:"success",title:"Successfully updated profile"})}),m=Ae(async()=>En(o),r),h=jn(o,t)?a.handleSubmit(m):null;return{form:a,onSubmit:h,onCancel:()=>a.reset(),values:o}}function Pn({profile:e}){const t=Nn(e);return n.jsxs(Lt,{in:!!e,children:[n.jsx(Ut,{children:n.jsxs(J,{gap:2,flexDir:"column",children:[n.jsx(Sn,{}),n.jsxs(Pt,{children:[n.jsx(It,{size:"md",as:"h1",children:e.username}),n.jsx(xn,{editor:t})]})]})}),n.jsx(Ht,{my:{base:4,md:0}}),n.jsx(Kt,{children:n.jsxs(kt,{divider:n.jsx(Vt,{}),gap:1,children:[n.jsx(vn,{editor:t}),n.jsx(hn,{editor:t}),n.jsx(he,{name:"Joined On",value:Rt(e.createdAt)}),n.jsx(he,{name:"Threads",value:e.threads.length}),n.jsx(he,{name:"Replies",value:e.replies.length}),n.jsx(he,{name:"Boards",value:e.boards.length})]})})]})}function In(){const{data:e,isLoading:t}=Ce();return n.jsx(zt,{variant:"outline",w:{base:"full",md:64,lg:80},position:{base:"static",md:"sticky"},top:"72px",h:{md:"calc(100vh - 88px)"},size:"sm",overflowY:"auto",as:"section","aria-label":"Profile Info",children:t?n.jsx(qt,{p:4,flex:1}):n.jsx(Pn,{profile:e.profile})})}function kn({children:e}){const{data:t}=Ce(),[a]=le();return!a&&t&&t.profile.username===t.user.username?n.jsx(wt,{to:"/me"}):n.jsxs(J,{flex:1,maxW:"full",gap:4,flexDir:{base:"column",md:"row"},children:[n.jsx(In,{}),e]})}function qn(){const[e,t]=le();return n.jsx(_t,{user:{isMe:e,username:t},children:n.jsx(kn,{children:n.jsx(At,{})})})}export{qn as default};
