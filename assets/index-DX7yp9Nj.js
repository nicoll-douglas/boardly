import{j as e,R as A,s as H,a2 as O,a3 as q,F as d,B as T,X as S,T as o,r as E,ad as M,L as P,V as c,x as C,y as _,aa as Q,ae as G}from"./index-BGfUVu-S.js";import{c as K}from"./chatting-2-DAUiPAEq.js";import{a as N,C as R,T as W,D as v,t as w}from"./DeletedLabel-DeHHynnp.js";import{u as J,T as U,B as V}from"./useProtectedSubmission-CNvaje-C.js";import{a as X}from"./index-jI1LxAkv.js";import{u as Y}from"./index.esm-QuqdPL-o.js";import{u as Z}from"./useSubmitHandlers-Pj0oRakZ.js";import{u as ee}from"./useMaxLength-CGxBN7rZ.js";import{F as se}from"./FormModal-1-jAWOym.js";import{u as re}from"./chunk-7JBTTEVG-DY5WfFj4.js";import{C as p,a as te,b as L}from"./chunk-YQO7BFFX-CUymwyLU.js";import{D as x}from"./chunk-W7WUSNWJ-DKxHapzC.js";import{A as g}from"./chunk-V7PAE35Z-C3vj6xRY.js";import{S as z}from"./chunk-7254PCTD-C1bqhFCI.js";import{S as ae}from"./Spinner-ChtAEK3J.js";import{B as ne}from"./BoardInfo-DMq4xsBQ.js";import"./useBoardsList-CtMwDoVA.js";import"./chunk-4FCEGNGT-CWNR6xLH.js";import"./chunk-OFOVX77R-UToEHXKx.js";import"./StackData-DuYmOgjm.js";import"./chunk-BL2ZZSHG-qHpNGzko.js";function ie({length:s,maxLength:r,...t}){return e.jsx(N,{colorScheme:s>r?"red":"gray",...t,children:r-s})}const b={required:!0,maxLength:{value:100,message:"Reply must be no longer than 100 characters"}};async function oe(s,r,t){return fetch("https://lorem-backend-6ggh.onrender.com/api/replies",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({body:s,thread:r,parent:t})})}function F({threadId:s,parentId:r=null,onSuccess:t}){var j;const a=A(),i=H(),n=Y(),{onChange:m,...h}=n.register("body",b),{length:u,onChange:B,setLength:D}=ee(),I=J(()=>{t&&t(),a.invalidateQueries({queryKey:["GET /api/me/replies"]}),a.invalidateQueries({queryKey:[`GET /api/threads/${s}`]}),n.reset(),D(0),i({status:"success",title:"Successfully replied"})}),k=Z(async()=>oe(n.getValues("body"),s,r),I);return e.jsxs("form",{onSubmit:n.handleSubmit(k),"aria-label":"Reply to thread",children:[e.jsxs(O,{isRequired:!0,isInvalid:n.formState.errors.body,mb:2,children:[e.jsx(U,{rows:4,placeholder:"What are your thoughts?",resize:"none",onChange:f=>{m(f),B(f)},...h}),e.jsx(q,{children:(j=n.formState.errors.body)==null?void 0:j.message})]}),e.jsxs(d,{gap:2,children:[e.jsx(T,{type:"submit",size:"sm",isLoading:n.formState.isSubmitting,children:"Submit"}),e.jsx(ie,{length:u,maxLength:b.maxLength.value})]})]})}function de({reply:s,...r}){const{isOpen:t,onOpen:a,onClose:i}=re(),{data:n}=l();return e.jsxs(e.Fragment,{children:[e.jsx(T,{rightIcon:e.jsx(X,{size:16}),variant:"ghost",size:"xs",onClick:a,...r,children:"Reply"}),e.jsxs(se,{isOpen:t,onClose:i,heading:`Reply to ${s.author.username}`,children:[e.jsxs(S,{mb:4,children:[e.jsx(R,{postText:"said:",link:`/users/${s.author.username}`,linkText:s.author.username}),e.jsx(o,{whiteSpace:"pre-wrap",lineHeight:1.25,children:s.body})]}),e.jsx(F,{threadId:n.thread._id,parentId:s._id,onSuccess:i})]})]})}function l(){return E.useContext(M)}function $({tagValues:s,user:r,children:t,replyBtn:a,reply:i,...n}){const{data:m}=l();return e.jsxs(p,{variant:"filled",size:"sm",w:"full",...n,children:[e.jsx(te,{children:e.jsxs(d,{gap:2,children:[s==null?void 0:s.map((h,u)=>e.jsx(W,{children:h},u)),a&&!m.thread.board.deleted&&e.jsx(de,{ml:"auto",reply:i})]})}),e.jsx(x,{}),e.jsx(L,{children:e.jsxs(d,{gap:{base:2,sm:3},flexDir:{base:"column",sm:"row"},children:[e.jsxs(d,{flexDir:{base:"row-reverse",sm:"column"},alignItems:{base:"center",sm:"start"},pr:{base:0,sm:3},borderRightWidth:{base:0,sm:1},gap:{base:2,sm:1},justifyContent:"start",children:[r.deleted?e.jsx(v,{children:"deleted user"}):e.jsx(V,{to:`/users/${r.username}`,py:0,h:"fit-content",pb:{base:1,sm:0},children:r.username}),r.deleted?e.jsx(g,{borderLeftRadius:{base:"full",sm:0},borderRightRadius:{base:"full",sm:0},borderRadius:{base:"full",sm:0},size:{base:"sm",sm:"lg",lg:"xl"}}):e.jsx(P,{to:`/users/${r.username}`,children:e.jsx(g,{name:r.username,src:r.avatar,borderLeftRadius:{base:"full",sm:0},borderRightRadius:{base:"full",sm:0},borderRadius:{base:"full",sm:0},size:{base:"sm",sm:"lg",lg:"xl"}})})]}),e.jsx(x,{display:{base:"flex",sm:"none"}}),e.jsx(c,{alignItems:"start",w:"full",gap:0,children:t})]})})]})}function le({reply:s}){return e.jsx(z,{in:!0,children:e.jsxs($,{tagValues:[w(s.createdAt)],user:s.author,reply:s,replyBtn:!0,as:"li",children:[s.parent&&e.jsxs(e.Fragment,{children:[s.parent.deleted?e.jsx(o,{fontStyle:"italic",color:"gray.500",children:"reply was deleted"}):e.jsx(e.Fragment,{children:e.jsxs(S,{children:[s.parent.author.deleted?e.jsx(v,{postText:"said:",size:"sm",children:"deleted user"}):e.jsx(R,{postText:"said:",link:`/users/${s.parent.author.username}`,linkText:s.parent.author.username,fontSize:"sm"}),e.jsx(o,{fontSize:"sm",whiteSpace:"pre-wrap",lineHeight:1.25,children:s.parent.body})]})}),e.jsx(x,{my:2})]}),e.jsx(o,{whiteSpace:"pre-wrap",lineHeight:1.25,children:s.body})]})})}function me({thread:s}){return e.jsxs($,{tagValues:[`${s.replies.length} repl${s.replies.length===1?"y":"ies"}`,w(s.createdAt)],user:s.author,mb:2,as:"main","aria-label":"Thread",children:[e.jsx(C,{size:"md",children:s.title}),s.body&&e.jsx(e.Fragment,{children:e.jsx(o,{whiteSpace:"pre-wrap",mt:2,lineHeight:1.25,children:s.body})})]})}function he(){const{data:s,isLoading:r}=l(),t=s==null?void 0:s.thread.board.deleted;return e.jsx(p,{variant:{base:"unstyled",md:"outline"},flex:1,size:"sm",children:r?e.jsx(ae,{p:4}):e.jsx(z,{in:!!s,offsetY:10,children:e.jsxs(L,{children:[e.jsx(me,{thread:s.thread}),t||e.jsx(F,{threadId:s.thread._id}),s.thread.replies.length===0?e.jsxs(c,{gap:0,textAlign:"center",mb:10,children:[e.jsx(_,{src:K,width:240,height:240}),e.jsx(C,{size:"md",children:"Nothing to show"}),t||e.jsx(o,{mt:1,children:"This thread has no replies, be the first start the conversation!"})]}):e.jsx(c,{gap:{base:2,sm:3},mt:{base:2,sm:3},alignItems:"stretch",as:"ul","aria-label":"Thread Replies",children:s.thread.replies.sort((a,i)=>new Date(a.createdAt).valueOf()-new Date(i.createdAt).valueOf()).map(a=>e.jsx(le,{reply:a},a._id))})]})})})}function y({variant:s}){const{data:r,isLoading:t}=l();if(!(r!=null&&r.thread.board.deleted))return e.jsx(ne,{data:r==null?void 0:r.thread,isLoading:t,variant:s})}function Ie(){const{threadId:s}=Q();return e.jsx(e.Fragment,{children:e.jsxs(G,{threadId:s,children:[e.jsxs(d,{flexDir:"column",gap:4,flex:1,as:p,variant:"unstyled",children:[e.jsx(y,{variant:"base"}),e.jsx(he,{})]}),e.jsx(y,{variant:"xl"})]})})}export{Ie as default};
