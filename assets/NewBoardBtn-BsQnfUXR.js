import{a1 as b,t as j,q as y,R as v,r as C,j as e,a2 as u,a3 as c,a4 as S,a5 as L,a6 as N,a7 as w,a8 as F,B as d}from"./index-CfX38i0E.js";import{L as E,A as B}from"./DeletedLabel-Jd_gx_v8.js";import{F as q}from"./FormModal-C1R4AyCJ.js";import{h as R}from"./helperText-BjkVZXYi.js";import{u as T}from"./useSubmitHandlers-Cwbi2rXh.js";import{u as I}from"./index.esm-7bvCp7Uk.js";import{u as M}from"./useMaxLength-BeQ-kzod.js";import{T as O}from"./useProtectedSubmission--UnRbhvM.js";import{u as z}from"./chunk-7JBTTEVG-DxtWywDM.js";const m={name:{required:"Name is required",pattern:{value:b.restricted,message:"Name contains an invalid character"},maxLength:{value:20,message:"Name must be no more than 20 characters long"}},rules:{required:!1,maxLength:{value:100,message:"Rules must be no more than 100 characters long"}}};async function Q(s){return fetch("https://demo.boardly.nicolldouglas.dev/api/boards",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}function U(s){const r=I({shouldUnregister:!0}),{toast:t,...a}=j(),n=async()=>Q(r.getValues()),o=y(),i=v(),l=C.useMemo(()=>({401:()=>{a.unauthorized(),o("/auth/login")},409:async g=>{const{feedback:p}=await g.json();p.forEach(({subject:x,message:f})=>r.setError(x,{message:f}))},429:()=>a.tooMany(),500:()=>a.serverError(),200:()=>{i.invalidateQueries({queryKey:["GET /api/me/boards"]}),i.invalidateQueries({queryKey:["GET /api/boards"]}),t({status:"success",title:"Successfully created board"}),s&&s()}}),[]),h=T(n,l);return{form:r,onSubmit:h}}function k({form:s,initialLength:r}){var i;const{onChange:t,...a}=s.register("rules",m.rules),{length:n,onChange:o}=M(r);return e.jsxs(u,{isInvalid:s.formState.errors.rules,mb:6,children:[e.jsx(E,{length:n,maxLength:m.rules.maxLength.value,children:"Rules"}),e.jsx(O,{resize:"none",placeholder:"Enter rules...",rows:8,whiteSpace:"pre-wrap",onChange:l=>{t(l),o(l)},...a}),e.jsx(c,{children:(i=s.formState.errors.rules)==null?void 0:i.message})]})}function A({onClose:s}){var a;const{form:r,onSubmit:t}=U(s);return e.jsxs("form",{onSubmit:r.handleSubmit(t),"aria-label":"New Board Form",children:[e.jsxs(u,{isRequired:!0,isInvalid:r.formState.errors.name,mb:6,children:[e.jsx(S,{children:"Name"}),e.jsx(L,{placeholder:"Enter name...",...r.register("name",m.name)}),e.jsx(c,{children:(a=r.formState.errors.name)==null?void 0:a.message}),e.jsx(N,{children:e.jsx(w,{children:["Cannot be changed once created",...R.newUn].map((n,o)=>e.jsx(F,{children:n},o))})})]}),e.jsx(k,{form:r,initialLength:0}),e.jsx(d,{w:"full",type:"submit",isLoading:r.formState.isSubmitting,children:"Create"})]})}function X({...s}){const{isOpen:r,onClose:t,onOpen:a}=z();return e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"ghost",size:"sm",leftIcon:e.jsx(B,{}),onClick:a,...s,children:"New Board"}),e.jsx(q,{isOpen:r,onClose:t,heading:"New Board",children:e.jsx(A,{onClose:t})})]})}export{X as N,k as R};
